<div class="card shadow-sm mt-4">
  <div class="card-header bg-light">
    <h5 class="mb-0"><i class="bi bi-chat-dots"></i> Comentarios</h5>
  </div>
  
  <div class="card-body">
    
    <div class="mb-4" style="max-height: 400px; overflow-y: auto;">
      @if (cargando) {
        <div class="text-center text-muted py-3">Cargando...</div>
      } 
      @else if (comentarios.length === 0) {
        <div class="alert alert-light text-center">
          No hay comentarios. ¡Sé el primero en escribir!
        </div>
      } 
      @else {
        <ul class="list-group list-group-flush">
          @for (com of comentarios; track com.id) {
            <li class="list-group-item px-0">
              <div class="d-flex justify-content-between">
                <strong class="text-primary">{{ com.nombreUsuario }}</strong>
                <small class="text-muted">{{ com.createdAt | date:'short' }}</small>
              </div>
              <p class="mb-0 mt-1" style="white-space: pre-wrap;">{{ com.content }}</p>
            </li>
          }
        </ul>
      }
    </div>

    @if (estadoTicket !== 'CERRADO') {
      <div class="d-flex gap-2">
        <textarea class="form-control" rows="2" 
                  placeholder="Escribe un comentario..."
                  [(ngModel)]="nuevoContenido"
                  [disabled]="enviando"></textarea>
        
        <button class="btn btn-primary align-self-end" 
                (click)="enviar()" 
                [disabled]="!nuevoContenido.trim() || enviando">
          @if (enviando) { <span class="spinner-border spinner-border-sm"></span> }
          @else { <i class="bi bi-send"></i> }
        </button>
      </div>
    } @else {
      <div class="alert alert-secondary mb-0 py-2">
        <i class="bi bi-lock"></i> Ticket cerrado. Comentarios deshabilitados.
      </div>
    }
  </div>
</div>